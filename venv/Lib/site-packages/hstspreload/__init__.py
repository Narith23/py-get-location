"""Check if a host is in the Google Chrome HSTS Preload list"""

import functools
import os
import typing

__version__ = "2024.3.1"
__checksum__ = "e4affd29e271b4fab9605359be7cad978931ece0f7e17e9f3287e0b3f338cd9c"
__all__ = ["in_hsts_preload"]

# fmt: off
_GTLD_INCLUDE_SUBDOMAINS = {b'amazon', b'android', b'app', b'audible', b'azure', b'bank', b'bing', b'boo', b'channel', b'chrome', b'dad', b'day', b'dev', b'eat', b'esq', b'fire', b'fly', b'foo', b'gle', b'gmail', b'google', b'hangout', b'hotmail', b'imdb', b'ing', b'insurance', b'kindle', b'meet', b'meme', b'microsoft', b'mov', b'new', b'nexus', b'office', b'page', b'phd', b'play', b'prime', b'prof', b'rsvp', b'search', b'silk', b'skype', b'windows', b'xbox', b'xn--cckwcxetd', b'xn--jlq480n2rg', b'youtube', b'zappos', b'zip'}  # noqa: E501
_JUMPTABLE = [[(0, 11), (11, 5), (16, 19), (35, 55), (90, 26), (116, 12), None, (128, 19), (147, 22), (169, 7), (176, 13), (189, 18), None, (207, 29), (236, 37), (273, 19), (292, 9), (301, 36), (337, 24), (361, 10), (371, 18), None, (389, 62), (451, 8), (459, 22), (481, 19), (500, 13), (513, 14), (527, 14), None, None, (541, 40), (581, 20), (601, 25), (626, 22), (648, 22), (670, 28), None, (698, 15), (713, 25), (738, 8), (746, 13), (759, 10), None, (769, 17), (786, 6), (792, 19), (811, 16), (827, 5), (832, 19), (851, 14), (865, 11), (876, 18), (894, 27), (921, 7), (928, 11), (939, 15), (954, 12), (966, 20), (986, 8), (994, 27), (1021, 46), (1067, 25), (1092, 16), (1108, 8), (1116, 5), (1121, 22), (1143, 18), None, (1161, 36), (1197, 15), (1212, 24), (1236, 11), None, (1247, 10), (1257, 23), (1280, 18), (1298, 18), None, (1316, 20), (1336, 26), (1362, 27), (1389, 28), (1417, 20), (1437, 59), (1496, 14), (1510, 14), (1524, 8), (1532, 8), (1540, 10), (1550, 13), (1563, 20), (1583, 19), None, (1602, 13), (1615, 26), (1641, 11), (1652, 4), (1656, 22), (1678, 10), (1688, 15), (1703, 14), (1717, 28), (1745, 11), (1756, 10), (1766, 12), (1778, 25), None, (1803, 19), (1822, 14), (1836, 26), (1862, 45), (1907, 15), None, (1922, 11), (1933, 30), (1963, 21), (1984, 26), (2010, 6), (2016, 6), (2022, 14), (2036, 5), (2041, 30), (2071, 23), (2094, 6), (2100, 17), (2117, 8), (2125, 12), (2137, 12), (2149, 70), (2219, 55), (2274, 12), (2286, 23), (2309, 16), (2325, 41), None, (2366, 24), (2390, 44), (2434, 6), (2440, 41), (2481, 22), (2503, 23), (2526, 31), (2557, 20), (2577, 8), (2585, 15), (2600, 12), (2612, 32), (2644, 25), (2669, 15), None, (2684, 46), (2730, 21), (2751, 17), (2768, 18), (2786, 26), (2812, 5), (2817, 37), (2854, 39), (2893, 16), (2909, 33), (2942, 17), (2959, 23), (2982, 21), (3003, 25), (3028, 8), (3036, 14), (3050, 7), (3057, 37), None, (3094, 18), (3112, 21), (3133, 20), (3153, 17), (3170, 24), (3194, 12), (3206, 36), (3242, 35), (3277, 12), (3289, 57), (3346, 25), (3371, 32), None, (3403, 8), (3411, 25), (3436, 18), (3454, 6), (3460, 23), None, (3483, 36), (3519, 33), (3552, 14), (3566, 16), (3582, 22), None, (3604, 30), (3634, 41), (3675, 50), (3725, 15), (3740, 20), (3760, 31), (3791, 21), (3812, 32), (3844, 24), (3868, 20), (3888, 17), (3905, 52), (3957, 6), (3963, 9), (3972, 12), (3984, 18), (4002, 11), (4013, 10), (4023, 39), (4062, 42), None, (4104, 36), (4140, 17), None, (4157, 8), (4165, 8), (4173, 7), None, (4180, 25), (4205, 17), None, (4222, 21), (4243, 35), (4278, 21), (4299, 10), (4309, 48), (4357, 11), (4368, 37), (4405, 25), (4430, 19), (4449, 12), (4461, 14), (4475, 23), (4498, 29), (4527, 14), (4541, 8), (4549, 47), (4596, 52), None, None, (4648, 47), (4695, 42), None, (4737, 18), None, (4755, 15), (4770, 8), (4778, 21), (4799, 6), (4805, 29), (4834, 22)], [(4856, 8092), (12948, 7923), (20871, 8288), (29159, 8223), (37382, 7732), (45114, 7908), (53022, 8371), (61393, 7631), (69024, 7871), (76895, 7626), (84521, 8207), (92728, 7202), (99930, 8043), (107973, 8949), (116922, 7910), (124832, 8787), (133619, 8850), (142469, 7347), (149816, 8415), (158231, 7463), (165694, 8273), (173967, 7931), (181898, 8098), (189996, 8513), (198509, 8134), (206643, 7725), (214368, 8601), (222969, 9079), (232048, 7689), (239737, 7803), (247540, 8548), (256088, 8158), (264246, 7983), (272229, 8370), (280599, 7887), (288486, 8594), (297080, 8324), (305404, 8905), (314309, 8471), (322780, 8430), (331210, 8424), (339634, 7484), (347118, 7834), (354952, 8007), (362959, 7707), (370666, 8449), (379115, 7776), (386891, 9189), (396080, 8001), (404081, 7425), (411506, 7899), (419405, 7654), (427059, 8131), (435190, 8225), (443415, 7815), (451230, 8090), (459320, 8162), (467482, 8309), (475791, 8112), (483903, 6795), (490698, 7354), (498052, 8381), (506433, 8014), (514447, 8557), (523004, 8869), (531873, 7695), (539568, 8192), (547760, 8484), (556244, 9002), (565246, 7821), (573067, 7539), (580606, 7530), (588136, 7223), (595359, 8837), (604196, 7809), (612005, 8208), (620213, 7656), (627869, 8892), (636761, 8053), (644814, 7940), (652754, 8014), (660768, 7358), (668126, 7959), (676085, 8208), (684293, 8119), (692412, 8101), (700513, 8615), (709128, 7901), (717029, 7336), (724365, 7959), (732324, 9200), (741524, 8130), (749654, 7677), (757331, 8114), (765445, 7919), (773364, 7874), (781238, 8112), (789350, 7360), (796710, 8348), (805058, 7498), (812556, 8054), (820610, 7674), (828284, 7918), (836202, 7748), (843950, 7815), (851765, 8530), (860295, 8260), (868555, 8251), (876806, 7773), (884579, 7806), (892385, 8641), (901026, 8101), (909127, 7425), (916552, 7643), (924195, 8096), (932291, 7961), (940252, 8046), (948298, 8467), (956765, 7907), (964672, 8028), (972700, 8038), (980738, 8043), (988781, 7613), (996394, 8145), (1004539, 8514), (1013053, 7671), (1020724, 7840), (1028564, 8739), (1037303, 7876), (1045179, 9159), (1054338, 8735), (1063073, 7782), (1070855, 7678), (1078533, 7394), (1085927, 7856), (1093783, 8735), (1102518, 8692), (1111210, 9252), (1120462, 8409), (1128871, 8385), (1137256, 9010), (1146266, 8506), (1154772, 7850), (1162622, 8122), (1170744, 8841), (1179585, 7239), (1186824, 8165), (1194989, 7776), (1202765, 7967), (1210732, 8154), (1218886, 8121), (1227007, 8171), (1235178, 8169), (1243347, 7523), (1250870, 7841), (1258711, 8260), (1266971, 8209), (1275180, 8213), (1283393, 7647), (1291040, 7328), (1298368, 7623), (1305991, 8073), (1314064, 8152), (1322216, 7726), (1329942, 8342), (1338284, 8591), (1346875, 8542), (1355417, 7692), (1363109, 9227), (1372336, 8013), (1380349, 7858), (1388207, 8082), (1396289, 8631), (1404920, 7533), (1412453, 7678), (1420131, 8216), (1428347, 8493), (1436840, 8425), (1445265, 7661), (1452926, 7552), (1460478, 9813), (1470291, 8568), (1478859, 7635), (1486494, 8002), (1494496, 8258), (1502754, 8261), (1511015, 7367), (1518382, 8568), (1526950, 8064), (1535014, 8124), (1543138, 8086), (1551224, 7562), (1558786, 7769), (1566555, 7278), (1573833, 8069), (1581902, 7300), (1589202, 7270), (1596472, 7472), (1603944, 7868), (1611812, 8307), (1620119, 8073), (1628192, 8128), (1636320, 8433), (1644753, 7280), (1652033, 8358), (1660391, 8527), (1668918, 7580), (1676498, 8314), (1684812, 8998), (1693810, 7578), (1701388, 8852), (1710240, 8119), (1718359, 7845), (1726204, 8162), (1734366, 8325), (1742691, 8246), (1750937, 7925), (1758862, 8291), (1767153, 7793), (1774946, 8675), (1783621, 7916), (1791537, 7411), (1798948, 8678), (1807626, 8007), (1815633, 8364), (1823997, 7672), (1831669, 8514), (1840183, 8451), (1848634, 8355), (1856989, 8870), (1865859, 8577), (1874436, 8101), (1882537, 7967), (1890504, 8326), (1898830, 7839), (1906669, 9012), (1915681, 8052), (1923733, 7441), (1931174, 7635), (1938809, 8577), (1947386, 8612), (1955998, 8384), (1964382, 8431), (1972813, 8172), (1980985, 7781), (1988766, 8723), (1997489, 8196), (2005685, 7994), (2013679, 8091), (2021770, 7215), (2028985, 8121), (2037106, 8126), (2045232, 7917), (2053149, 7863), (2061012, 7964), (2068976, 8279)], [(2077255, 869), (2078124, 728), (2078852, 801), (2079653, 738), (2080391, 802), (2081193, 769), (2081962, 623), (2082585, 891), (2083476, 592), (2084068, 854), (2084922, 485), (2085407, 611), (2086018, 846), (2086864, 942), (2087806, 740), (2088546, 584), (2089130, 1201), (2090331, 629), (2090960, 682), (2091642, 814), (2092456, 1051), (2093507, 700), (2094207, 725), (2094932, 622), (2095554, 709), (2096263, 655), (2096918, 819), (2097737, 1285), (2099022, 730), (2099752, 741), (2100493, 772), (2101265, 689), (2101954, 623), (2102577, 731), (2103308, 1005), (2104313, 882), (2105195, 505), (2105700, 779), (2106479, 681), (2107160, 845), (2108005, 794), (2108799, 713), (2109512, 675), (2110187, 801), (2110988, 671), (2111659, 698), (2112357, 649), (2113006, 727), (2113733, 684), (2114417, 469), (2114886, 649), (2115535, 730), (2116265, 738), (2117003, 811), (2117814, 1185), (2118999, 635), (2119634, 729), (2120363, 677), (2121040, 553), (2121593, 617), (2122210, 786), (2122996, 878), (2123874, 949), (2124823, 833), (2125656, 673), (2126329, 694), (2127023, 921), (2127944, 629), (2128573, 558), (2129131, 1021), (2130152, 690), (2130842, 710), (2131552, 396), (2131948, 698), (2132646, 408), (2133054, 676), (2133730, 578), (2134308, 915), (2135223, 859), (2136082, 555), (2136637, 785), (2137422, 743), (2138165, 876), (2139041, 705), (2139746, 787), (2140533, 780), (2141313, 708), (2142021, 572), (2142593, 848), (2143441, 879), (2144320, 1130), (2145450, 1028), (2146478, 896), (2147374, 700), (2148074, 667), (2148741, 457), (2149198, 942), (2150140, 706), (2150846, 762), (2151608, 614), (2152222, 739), (2152961, 713), (2153674, 759), (2154433, 534), (2154967, 780), (2155747, 903), (2156650, 619), (2157269, 571), (2157840, 794), (2158634, 860), (2159494, 766), (2160260, 952), (2161212, 985), (2162197, 679), (2162876, 659), (2163535, 699), (2164234, 706), (2164940, 823), (2165763, 643), (2166406, 664), (2167070, 1073), (2168143, 698), (2168841, 851), (2169692, 727), (2170419, 748), (2171167, 623), (2171790, 809), (2172599, 784), (2173383, 575), (2173958, 892), (2174850, 639), (2175489, 823), (2176312, 597), (2176909, 649), (2177558, 587), (2178145, 860), (2179005, 702), (2179707, 663), (2180370, 628), (2180998, 799), (2181797, 774), (2182571, 673), (2183244, 602), (2183846, 536), (2184382, 734), (2185116, 448), (2185564, 781), (2186345, 637), (2186982, 831), (2187813, 633), (2188446, 742), (2189188, 540), (2189728, 763), (2190491, 876), (2191367, 994), (2192361, 764), (2193125, 800), (2193925, 952), (2194877, 871), (2195748, 682), (2196430, 911), (2197341, 642), (2197983, 813), (2198796, 870), (2199666, 1023), (2200689, 1009), (2201698, 551), (2202249, 908), (2203157, 684), (2203841, 602), (2204443, 720), (2205163, 496), (2205659, 1026), (2206685, 606), (2207291, 937), (2208228, 803), (2209031, 874), (2209905, 618), (2210523, 628), (2211151, 700), (2211851, 1852), (2213703, 692), (2214395, 690), (2215085, 843), (2215928, 964), (2216892, 639), (2217531, 756), (2218287, 822), (2219109, 573), (2219682, 903), (2220585, 667), (2221252, 578), (2221830, 559), (2222389, 1052), (2223441, 715), (2224156, 692), (2224848, 579), (2225427, 651), (2226078, 893), (2226971, 590), (2227561, 774), (2228335, 728), (2229063, 833), (2229896, 684), (2230580, 625), (2231205, 593), (2231798, 696), (2232494, 947), (2233441, 831), (2234272, 685), (2234957, 757), (2235714, 650), (2236364, 836), (2237200, 1111), (2238311, 500), (2238811, 771), (2239582, 671), (2240253, 770), (2241023, 660), (2241683, 579), (2242262, 668), (2242930, 795), (2243725, 725), (2244450, 1059), (2245509, 550), (2246059, 648), (2246707, 681), (2247388, 721), (2248109, 727), (2248836, 742), (2249578, 784), (2250362, 488), (2250850, 918), (2251768, 567), (2252335, 685), (2253020, 686), (2253706, 816), (2254522, 587), (2255109, 868), (2255977, 836), (2256813, 784), (2257597, 491), (2258088, 823), (2258911, 464), (2259375, 825), (2260200, 538), (2260738, 662), (2261400, 824), (2262224, 619), (2262843, 886), (2263729, 2298), (2266027, 607), (2266634, 757), (2267391, 748), (2268139, 829), (2268968, 661)], [(2269629, 48), None, None, (2269677, 42), None, (2269719, 27), (2269746, 18), None, None, None, None, None, None, None, (2269764, 21), None, None, (2269785, 42), None, (2269827, 25), (2269852, 44), None, (2269896, 49), None, None, None, None, None, None, None, None, None, (2269945, 21), (2269966, 46), None, None, (2270012, 44), None, None, None, None, (2270056, 44), (2270100, 21), (2270121, 23), None, None, None, None, (2270144, 42), None, None, None, None, None, (2270186, 31), None, None, None, None, (2270217, 42), (2270259, 19), None, None, (2270278, 21), None, (2270299, 26), (2270325, 56), None, (2270381, 16), (2270397, 42), (2270439, 27), None, None, None, None, (2270466, 21), (2270487, 52), None, (2270539, 17), (2270556, 20), (2270576, 42), None, None, None, (2270618, 25), (2270643, 17), (2270660, 27), (2270687, 21), None, None, None, (2270708, 24), None, (2270732, 24), (2270756, 21), (2270777, 24), None, (2270801, 48), None, None, (2270849, 17), (2270866, 19), None, None, None, None, (2270885, 31), None, None, None, None, None, None, (2270916, 28), None, (2270944, 64), (2271008, 42), (2271050, 17), (2271067, 17), (2271084, 26), None, (2271110, 19), None, None, None, None, (2271129, 20), None, None, (2271149, 42), (2271191, 63), (2271254, 17), None, None, (2271271, 21), None, None, None, None, (2271292, 21), (2271313, 16), None, (2271329, 31), None, None, None, None, (2271360, 42), None, (2271402, 80), None, (2271482, 9), None, (2271491, 21), (2271512, 42), None, (2271554, 18), (2271572, 90), (2271662, 56), (2271718, 45), None, (2271763, 42), None, None, (2271805, 24), (2271829, 21), None, None, None, None, None, (2271850, 42), (2271892, 21), (2271913, 21), None, (2271934, 42), (2271976, 25), None, (2272001, 40), (2272041, 21), (2272062, 56), None, None, (2272118, 36), None, None, None, (2272154, 16), None, (2272170, 35), None, None, (2272205, 21), None, (2272226, 22), (2272248, 21), (2272269, 21), (2272290, 21), None, (2272311, 63), (2272374, 41), (2272415, 21), (2272436, 42), None, None, None, None, None, (2272478, 15), (2272493, 21), (2272514, 21), None, None, (2272535, 21), None, None, (2272556, 21), None, None, (2272577, 19), (2272596, 66), None, None, None, (2272662, 50), None, (2272712, 21), (2272733, 21), (2272754, 19), None, None, (2272773, 26), None, (2272799, 39), (2272838, 42), None, None, None, None, None, None, (2272880, 21), None, None, None, (2272901, 21), None, None, (2272922, 64), None, (2272986, 254), (2273240, 21), (2273261, 24), None, (2273285, 21), (2273306, 14)], [None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, (2273320, 62), None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None, None]]  # noqa: E501
_CRC8_TABLE = [
    0x00, 0x07, 0x0e, 0x09, 0x1c, 0x1b, 0x12, 0x15,
    0x38, 0x3f, 0x36, 0x31, 0x24, 0x23, 0x2a, 0x2d,
    0x70, 0x77, 0x7e, 0x79, 0x6c, 0x6b, 0x62, 0x65,
    0x48, 0x4f, 0x46, 0x41, 0x54, 0x53, 0x5a, 0x5d,
    0xe0, 0xe7, 0xee, 0xe9, 0xfc, 0xfb, 0xf2, 0xf5,
    0xd8, 0xdf, 0xd6, 0xd1, 0xc4, 0xc3, 0xca, 0xcd,
    0x90, 0x97, 0x9e, 0x99, 0x8c, 0x8b, 0x82, 0x85,
    0xa8, 0xaf, 0xa6, 0xa1, 0xb4, 0xb3, 0xba, 0xbd,
    0xc7, 0xc0, 0xc9, 0xce, 0xdb, 0xdc, 0xd5, 0xd2,
    0xff, 0xf8, 0xf1, 0xf6, 0xe3, 0xe4, 0xed, 0xea,
    0xb7, 0xb0, 0xb9, 0xbe, 0xab, 0xac, 0xa5, 0xa2,
    0x8f, 0x88, 0x81, 0x86, 0x93, 0x94, 0x9d, 0x9a,
    0x27, 0x20, 0x29, 0x2e, 0x3b, 0x3c, 0x35, 0x32,
    0x1f, 0x18, 0x11, 0x16, 0x03, 0x04, 0x0d, 0x0a,
    0x57, 0x50, 0x59, 0x5e, 0x4b, 0x4c, 0x45, 0x42,
    0x6f, 0x68, 0x61, 0x66, 0x73, 0x74, 0x7d, 0x7a,
    0x89, 0x8e, 0x87, 0x80, 0x95, 0x92, 0x9b, 0x9c,
    0xb1, 0xb6, 0xbf, 0xb8, 0xad, 0xaa, 0xa3, 0xa4,
    0xf9, 0xfe, 0xf7, 0xf0, 0xe5, 0xe2, 0xeb, 0xec,
    0xc1, 0xc6, 0xcf, 0xc8, 0xdd, 0xda, 0xd3, 0xd4,
    0x69, 0x6e, 0x67, 0x60, 0x75, 0x72, 0x7b, 0x7c,
    0x51, 0x56, 0x5f, 0x58, 0x4d, 0x4a, 0x43, 0x44,
    0x19, 0x1e, 0x17, 0x10, 0x05, 0x02, 0x0b, 0x0c,
    0x21, 0x26, 0x2f, 0x28, 0x3d, 0x3a, 0x33, 0x34,
    0x4e, 0x49, 0x40, 0x47, 0x52, 0x55, 0x5c, 0x5b,
    0x76, 0x71, 0x78, 0x7f, 0x6a, 0x6d, 0x64, 0x63,
    0x3e, 0x39, 0x30, 0x37, 0x22, 0x25, 0x2c, 0x2b,
    0x06, 0x01, 0x08, 0x0f, 0x1a, 0x1d, 0x14, 0x13,
    0xae, 0xa9, 0xa0, 0xa7, 0xb2, 0xb5, 0xbc, 0xbb,
    0x96, 0x91, 0x98, 0x9f, 0x8a, 0x8d, 0x84, 0x83,
    0xde, 0xd9, 0xd0, 0xd7, 0xc2, 0xc5, 0xcc, 0xcb,
    0xe6, 0xe1, 0xe8, 0xef, 0xfa, 0xfd, 0xf4, 0xf3
]
# fmt: on

_IS_LEAF = 0x80
_INCLUDE_SUBDOMAINS = 0x40


try:
    from importlib.resources import open_binary

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open_binary("hstspreload", path)


except ImportError:

    def open_pkg_binary(path: str) -> typing.BinaryIO:
        return open(
            os.path.join(os.path.dirname(os.path.abspath(__file__)), path),
            "rb",
        )


@functools.lru_cache(maxsize=1024)
def in_hsts_preload(host: typing.AnyStr) -> bool:
    """Determines if an IDNA-encoded host is on the HSTS preload list"""

    if isinstance(host, str):
        host = host.encode("ascii")
    labels = host.lower().split(b".")

    # Fast-branch for gTLDs that are registered to preload all sub-domains.
    if labels[-1] in _GTLD_INCLUDE_SUBDOMAINS:
        return True

    with open_pkg_binary("hstspreload.bin") as f:
        for layer, label in enumerate(labels[::-1]):
            # None of our layers are greater than 5 deep.
            if layer > 4:
                return False

            # Read the jump table for the layer and label
            jump_info = _JUMPTABLE[layer][_crc8(label)]
            if jump_info is None:
                # No entry: host is not preloaded
                return False

            # Read the set of entries for that layer and label
            f.seek(jump_info[0])
            data = bytearray(jump_info[1])
            f.readinto(data)

            for is_leaf, include_subdomains, ent_label in _iter_entries(data):
                # We found a potential leaf
                if is_leaf:
                    if ent_label == host:
                        return True
                    if include_subdomains and host.endswith(b"." + ent_label):
                        return True

                # Continue traversing as we're not at a leaf.
                elif label == ent_label:
                    break
            else:
                return False
    return False


def _iter_entries(data: bytes) -> typing.Iterable[typing.Tuple[int, int, bytes]]:
    while data:
        flags = data[0]
        size = data[1]
        label = bytes(data[2 : 2 + size])
        yield (flags & _IS_LEAF, flags & _INCLUDE_SUBDOMAINS, label)
        data = data[2 + size :]


def _crc8(value: bytes) -> int:
    # CRC8 reference implementation: https://github.com/niccokunzmann/crc8
    checksum = 0x00
    for byte in value:
        checksum = _CRC8_TABLE[checksum ^ byte]
    return checksum
